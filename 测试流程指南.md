# AIMinO å®Œæ•´æµ‹è¯•æµç¨‹æŒ‡å—

æœ¬æŒ‡å—è¯¦ç»†è¯´æ˜å¦‚ä½•å®‰è£…å’Œæµ‹è¯• AIMinO ç³»ç»Ÿçš„å‰ç«¯å’Œåç«¯ï¼ŒåŒ…æ‹¬ä» PyPI å®‰è£…å’Œæœ¬åœ°å¼€å‘ä¸¤ç§æ–¹å¼ã€‚

---

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿè¦æ±‚](#ç³»ç»Ÿè¦æ±‚)
2. [æ–¹æ¡ˆAï¼šä» PyPI å®‰è£…ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰](#æ–¹æ¡ˆaä»-pypi-å®‰è£…ç”Ÿäº§ç¯å¢ƒ)
3. [æ–¹æ¡ˆBï¼šæœ¬åœ°å¼€å‘ç¯å¢ƒ](#æ–¹æ¡ˆbæœ¬åœ°å¼€å‘ç¯å¢ƒ)
4. [æµ‹è¯•æ­¥éª¤](#æµ‹è¯•æ­¥éª¤)
5. [å¸¸è§é—®é¢˜æ’æŸ¥](#å¸¸è§é—®é¢˜æ’æŸ¥)

---

## ä¸€ã€ç³»ç»Ÿè¦æ±‚

### å¿…éœ€è½¯ä»¶

- **Python**: >= 3.10
- **Docker**: >= 20.10ï¼ˆç”¨äºè¿è¡Œåç«¯ï¼‰
- **Napari**: >= 0.4.0ï¼ˆç”¨äºå‰ç«¯å¯è§†åŒ–ï¼‰

### å¯é€‰è½¯ä»¶

- **Conda**: ç”¨äºç®¡ç† Python ç¯å¢ƒï¼ˆæ¨èï¼‰
- **Git**: ç”¨äºå…‹éš†ä»£ç ä»“åº“

---

## äºŒã€æ–¹æ¡ˆAï¼šä» PyPI å®‰è£…ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

é€‚ç”¨äºåªæƒ³ä½¿ç”¨ AIMinO æ’ä»¶çš„ç”¨æˆ·ï¼Œä¸éœ€è¦ä¿®æ”¹ä»£ç ã€‚

### 2.1 åˆ›å»ºä¸´æ—¶æµ‹è¯•ç¯å¢ƒï¼ˆæ¨èï¼‰

ä¸ºäº†ç¡®ä¿æµ‹è¯•ç¯å¢ƒçš„å¹²å‡€å’Œéš”ç¦»ï¼Œå»ºè®®åˆ›å»ºä¸€ä¸ªæ–°çš„è™šæ‹Ÿç¯å¢ƒè¿›è¡Œæµ‹è¯•ã€‚

**é‡è¦ï¼š** å¯ä»¥åœ¨**ä»»ä½•ç›®å½•**åˆ›å»ºä¸´æ—¶ç¯å¢ƒï¼Œæ¨èåœ¨é¡¹ç›®ç›®å½•å¤–æˆ–ä¸´æ—¶ç›®å½•åˆ›å»ºï¼Œä¾‹å¦‚ï¼š

```bash
# é€‰é¡¹1ï¼šåœ¨é¡¹ç›®ç›®å½•å¤–åˆ›å»ºï¼ˆæ¨èï¼‰
cd ~  # æˆ– cd /tmpï¼Œæˆ–ä»»ä½•æ–¹ä¾¿çš„ä½ç½®
python -m venv test_aimino_env

# é€‰é¡¹2ï¼šåœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºï¼ˆä¹Ÿå¯ä»¥ï¼‰
cd AC215_AIMinO
python -m venv test_aimino_env
```

#### ä½¿ç”¨ venv åˆ›å»ºä¸´æ—¶ç¯å¢ƒ

```bash
# åœ¨ä»»ä½•ä½ é€‰æ‹©çš„ç›®å½•ä¸‹æ‰§è¡Œ
# åˆ›å»ºæ–°çš„è™šæ‹Ÿç¯å¢ƒ
python -m venv test_aimino_env

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# macOS/Linux:
source test_aimino_env/bin/activate

# Windows:
test_aimino_env\Scripts\activate
```

**ç›®å½•è¯´æ˜ï¼š**
- è™šæ‹Ÿç¯å¢ƒå¯ä»¥åˆ›å»ºåœ¨ä»»ä½•ä½ç½®
- æ¨èåœ¨é¡¹ç›®ç›®å½•å¤–åˆ›å»ºï¼Œä¾¿äºç®¡ç†
- ç¯å¢ƒæ¿€æ´»åï¼Œå¯ä»¥åœ¨ä»»ä½•ç›®å½•ä¸‹å®‰è£…å’Œä½¿ç”¨åŒ…

**æ¿€æ´»æˆåŠŸåï¼Œå‘½ä»¤æç¤ºç¬¦ä¼šæ˜¾ç¤º `(test_aimino_env)`**

#### ä½¿ç”¨ Conda åˆ›å»ºä¸´æ—¶ç¯å¢ƒï¼ˆå¯é€‰ï¼‰

```bash
# åˆ›å»ºæ–°çš„ Conda ç¯å¢ƒ
conda create -n test_aimino python=3.10

# æ¿€æ´»ç¯å¢ƒ
conda activate test_aimino
```

**ä¸ºä»€ä¹ˆä½¿ç”¨ä¸´æ—¶ç¯å¢ƒï¼Ÿ**
- âœ… éš”ç¦»æµ‹è¯•ï¼šä¸å½±å“ç³»ç»Ÿ Python æˆ–å…¶ä»–é¡¹ç›®
- âœ… å¹²å‡€ç¯å¢ƒï¼šç¡®ä¿æµ‹è¯•çš„æ˜¯å…¨æ–°å®‰è£…
- âœ… æ˜“äºæ¸…ç†ï¼šæµ‹è¯•å®Œæˆåå¯ä»¥åˆ é™¤
- âœ… æ¨¡æ‹ŸçœŸå®ç”¨æˆ·ï¼šç”¨æˆ·é€šå¸¸åœ¨æ–°ç¯å¢ƒä¸­å®‰è£…

**æ³¨æ„ï¼š** æµ‹è¯•å®Œæˆåï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤é€€å‡ºå’Œåˆ é™¤ç¯å¢ƒï¼š

```bash
# é€€å‡ºè™šæ‹Ÿç¯å¢ƒ
deactivate

# åˆ é™¤è™šæ‹Ÿç¯å¢ƒï¼ˆå¯é€‰ï¼Œæµ‹è¯•å®Œæˆåï¼‰
rm -rf test_aimino_env  # venv
# æˆ–
conda deactivate
conda env remove -n test_aimino  # conda
```

### 2.2 å®‰è£…å‰ç«¯

#### æ–¹æ³•1ï¼šä» PyPI å®‰è£…ï¼ˆæ¨èï¼‰

```bash
# ç¡®ä¿è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»ï¼ˆå‘½ä»¤æç¤ºç¬¦æ˜¾ç¤ºç¯å¢ƒåï¼‰
# ç›´æ¥å®‰è£…å·²å‘å¸ƒçš„åŒ…
pip install aimino
```

#### æ–¹æ³•2ï¼šä»æºç å®‰è£…ï¼ˆå¦‚æœåŒ…æœªå‘å¸ƒï¼‰

```bash
# å…‹éš†æˆ–ä¸‹è½½é¡¹ç›®
cd AC215_AIMinO

# è¿›å…¥å‰ç«¯ç›®å½•
cd aimino_frontend

# å®‰è£…å‰ç«¯åŒ…
pip install -e .
```

**æ³¨æ„ï¼š** å¦‚æœä½¿ç”¨ä¸´æ—¶ç¯å¢ƒï¼Œç¡®ä¿åœ¨æ¿€æ´»è™šæ‹Ÿç¯å¢ƒåå†æ‰§è¡Œå®‰è£…å‘½ä»¤ã€‚

### 2.3 éªŒè¯å‰ç«¯å®‰è£…

```bash
# æ£€æŸ¥åŒ…æ˜¯å¦å®‰è£…æˆåŠŸ
pip show aimino

# éªŒè¯å‘½ä»¤è¡Œå·¥å…·
aimino-napari --help

# éªŒè¯ Python å¯¼å…¥
python -c "import aimino_frontend; print('å‰ç«¯å®‰è£…æˆåŠŸï¼')"
```

**æœŸæœ›è¾“å‡ºï¼š**
```
Name: aimino
Version: 0.1.0
Summary: AIMinO Napari frontend application with command execution and agent client
...
```

### 2.4 å¯åŠ¨åç«¯æœåŠ¡

åç«¯éœ€è¦é€šè¿‡ Docker è¿è¡Œã€‚

#### æ­¥éª¤1ï¼šå‡†å¤‡ç¯å¢ƒå˜é‡æ–‡ä»¶

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
cd AC215_AIMinO

# å¦‚æœå­˜åœ¨ .env.exampleï¼Œå¤åˆ¶å®ƒ
cp .env.example .env

# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œæ·»åŠ å¿…è¦çš„é…ç½®
nano .env
```

**å¿…éœ€çš„é…ç½®é¡¹ï¼š**

```bash
# Google GenAI API Keyï¼ˆç”¨äº LLM åŠŸèƒ½ï¼‰
GOOGLE_API_KEY=your_api_key_here
# æˆ–
GEMINI_API_KEY=your_api_key_here

# æœåŠ¡å™¨ç«¯å£ï¼ˆå¯é€‰ï¼Œé»˜è®¤ 8000ï¼‰
AIMINO_SERVER_PORT=8000

# API å‰ç¼€ï¼ˆå¯é€‰ï¼Œé»˜è®¤ /api/v1ï¼‰
AIMINO_API_PREFIX=/api/v1
```

#### æ­¥éª¤2ï¼šæ„å»º Docker é•œåƒ

```bash
# ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼ˆåŒ…å« src/ å’Œ aimino_frontend/ çš„ç›®å½•ï¼‰
cd AC215_AIMinO

# æ„å»ºåç«¯ Docker é•œåƒ
DOCKER_BUILDKIT=1 docker build -t aimino-api:dev -f src/api_service/Dockerfile .
```

**æ„å»ºæ—¶é—´ï¼š** é¦–æ¬¡æ„å»ºå¯èƒ½éœ€è¦ 5-10 åˆ†é’Ÿï¼Œå–å†³äºç½‘ç»œé€Ÿåº¦ã€‚

#### æ­¥éª¤3ï¼šå¯åŠ¨åç«¯æœåŠ¡

```bash
# è¿è¡Œ Docker å®¹å™¨
docker run --rm -p 8000:8000 --env-file .env aimino-api:dev
```

**æˆåŠŸè¾“å‡ºï¼š**
```
INFO:     Started server process [1]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
```

**æ³¨æ„ï¼š** 
- æœåŠ¡è¿è¡Œåœ¨ `http://localhost:8000`
- æŒ‰ `Ctrl+C` åœæ­¢æœåŠ¡
- `--rm` å‚æ•°è¡¨ç¤ºå®¹å™¨åœæ­¢åè‡ªåŠ¨åˆ é™¤

#### æ­¥éª¤4ï¼šéªŒè¯åç«¯æœåŠ¡

åœ¨**æ–°çš„ç»ˆç«¯çª—å£**ä¸­æµ‹è¯•ï¼š

```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥ç«¯ç‚¹
curl http://127.0.0.1:8000/api/v1/healthz
```

**æœŸæœ›è¾“å‡ºï¼š**
```json
{"status":"ok","version":"0.1.0"}
```

**æµ‹è¯• API è°ƒç”¨ï¼š**

```bash
# æµ‹è¯• invoke ç«¯ç‚¹
curl -X POST http://127.0.0.1:8000/api/v1/invoke \
  -H 'Content-Type: application/json' \
  -d '{"user_input":"show layers"}'
```

**æœŸæœ›è¾“å‡ºï¼š**
```json
{
  "session_id": "...",
  "final_commands": [...]
}
```

### 2.5 å¯åŠ¨å‰ç«¯ï¼ˆNapariï¼‰

**é‡è¦æ›´æ–°ï¼š** å‰ç«¯ç°åœ¨é»˜è®¤è¿æ¥åˆ° `http://127.0.0.1:8000`ï¼Œ**æ— éœ€æ‰‹åŠ¨è®¾ç½®ç¯å¢ƒå˜é‡**ï¼

#### å¯åŠ¨ Napari

**é»˜è®¤è¡Œä¸ºï¼š**
- å‰ç«¯ä¼šè‡ªåŠ¨å°è¯•è¿æ¥åˆ° `http://127.0.0.1:8000`ï¼ˆæœ¬åœ°åç«¯ï¼‰
- å¦‚æœåç«¯æœåŠ¡æ­£åœ¨è¿è¡Œï¼Œå‰ç«¯ä¼šè‡ªåŠ¨è¿æ¥
- æ— éœ€ä»»ä½•é…ç½®å³å¯ä½¿ç”¨

**é«˜çº§é…ç½®ï¼ˆå¯é€‰ï¼‰ï¼š**

å¦‚æœéœ€è¦è‡ªå®šä¹‰åç«¯åœ°å€æˆ–ä½¿ç”¨å¼€å‘æ¨¡å¼ï¼Œå¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡ï¼š

**é€‰é¡¹Aï¼šè‡ªå®šä¹‰åç«¯åœ°å€**

```bash
# è®¾ç½®è‡ªå®šä¹‰åç«¯ API åœ°å€
export SERVER_URL=http://your-backend-server:8000

# ç„¶åå¯åŠ¨ Napari
napari
```

**é€‰é¡¹Bï¼šä½¿ç”¨æœ¬åœ°è¿è¡Œå™¨ï¼ˆå¼€å‘æ¨¡å¼ï¼Œä¸éœ€è¦åç«¯æœåŠ¡ï¼‰**

```bash
# å¯ç”¨æœ¬åœ°è¿è¡Œå™¨æ¨¡å¼
export DEV_LOCAL_RUNNER=1

# ç„¶åå¯åŠ¨ Napari
napari
```

**æ³¨æ„ï¼š**
- é»˜è®¤æƒ…å†µä¸‹ï¼Œç¡®ä¿åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œï¼ˆè§æ­¥éª¤ 2.4ï¼‰
- å¦‚æœåç«¯æœªè¿è¡Œï¼Œå‰ç«¯ä¼šæ˜¾ç¤ºè¿æ¥é”™è¯¯
- ç¯å¢ƒå˜é‡æ˜¯å¯é€‰çš„ï¼Œå¤§å¤šæ•°ç”¨æˆ·ä¸éœ€è¦è®¾ç½®

**æ–¹æ³•1ï¼šé€šè¿‡ Napari èœå•ï¼ˆæ¨èï¼‰**

```bash
# åœ¨è®¾ç½®äº†ç¯å¢ƒå˜é‡çš„ç»ˆç«¯ä¸­å¯åŠ¨ Napari
napari

# åœ¨ Napari ç•Œé¢ä¸­ï¼š
# 1. ç‚¹å‡»èœå•æ  "Plugins"
# 2. é€‰æ‹© "AIMinO ChatBox"
# 3. ç‚¹å‡» "Open ChatBox"
# 4. ChatBox ä¼šå‡ºç°åœ¨å³ä¾§çš„ dock åŒºåŸŸ
```

**æ–¹æ³•2ï¼šå‘½ä»¤è¡Œå¯åŠ¨**

```bash
# ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·
aimino-napari

# æˆ–ä½¿ç”¨ Python æ¨¡å—
python -m aimino_frontend.napari_app.main
```

**æ³¨æ„ï¼š** 
- ç¡®ä¿åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œï¼ˆå¦‚æœä½¿ç”¨ `SERVER_URL` æ¨¡å¼ï¼‰
- å¦‚æœé‡åˆ° `RuntimeError: SERVER_URL not set and DEV_LOCAL_RUNNER!=1`ï¼Œè¯´æ˜ç¯å¢ƒå˜é‡æœªè®¾ç½®

---

## ä¸‰ã€æ–¹æ¡ˆBï¼šæœ¬åœ°å¼€å‘ç¯å¢ƒ

é€‚ç”¨äºéœ€è¦ä¿®æ”¹ä»£ç çš„å¼€å‘è€…ã€‚

### 3.1 åˆ›å»ºå¼€å‘ç¯å¢ƒ

#### ä½¿ç”¨ Condaï¼ˆæ¨èï¼‰

```bash
# è¿›å…¥é¡¹ç›®æ ¹ç›®å½•
cd AC215_AIMinO

# åˆ›å»º .env æ–‡ä»¶
cp .env.example .env
# ç¼–è¾‘ .env æ·»åŠ å¿…è¦çš„é…ç½®

# åˆ›å»º Conda ç¯å¢ƒ
conda env create -f environment.yml

# æ¿€æ´»ç¯å¢ƒ
conda activate aimino
```

#### ä½¿ç”¨ venvï¼ˆæ›¿ä»£æ–¹æ¡ˆï¼‰

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# macOS/Linux:
source venv/bin/activate
# Windows:
venv\Scripts\activate

# å®‰è£…ä¾èµ–ï¼ˆéœ€è¦å…ˆæŸ¥çœ‹ environment.yml ä¸­çš„ä¾èµ–ï¼‰
pip install -r requirements.txt  # å¦‚æœæœ‰çš„è¯
```

**æ³¨æ„ï¼š** å¼€å‘ç¯å¢ƒä¸æµ‹è¯•ç¯å¢ƒä¸åŒï¼š
- **å¼€å‘ç¯å¢ƒ**ï¼šç”¨äºå¼€å‘å’Œä¿®æ”¹ä»£ç ï¼Œå¯ä»¥é•¿æœŸä½¿ç”¨
- **æµ‹è¯•ç¯å¢ƒ**ï¼šç”¨äºæµ‹è¯•å®‰è£…å’ŒåŠŸèƒ½ï¼Œæµ‹è¯•å®Œæˆåå¯ä»¥åˆ é™¤

### 3.2 å®‰è£…å‰ç«¯ï¼ˆå¼€å‘æ¨¡å¼ï¼‰

```bash
# è¿›å…¥å‰ç«¯ç›®å½•
cd aimino_frontend

# ä»¥å¼€å‘æ¨¡å¼å®‰è£…ï¼ˆå¯ç¼–è¾‘æ¨¡å¼ï¼‰
pip install -e .
```

**å¼€å‘æ¨¡å¼çš„ä¼˜åŠ¿ï¼š**
- ä¿®æ”¹ä»£ç åç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡æ–°å®‰è£…
- å¯ä»¥è°ƒè¯•å’Œä¿®æ”¹æºä»£ç 

### 3.3 å¯åŠ¨åç«¯ï¼ˆå¼€å‘æ¨¡å¼ï¼‰

#### æ–¹æ³•1ï¼šä½¿ç”¨ Dockerï¼ˆæ¨èï¼‰

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
cd AC215_AIMinO

# æ„å»ºé•œåƒï¼ˆå¦‚æœè¿˜æ²¡æ„å»ºï¼‰
DOCKER_BUILDKIT=1 docker build -t aimino-api:dev -f src/api_service/Dockerfile .

# ä½¿ç”¨å¼€å‘æ¨¡å¼è¿è¡Œï¼ˆæ”¯æŒä»£ç çƒ­é‡è½½ï¼‰
HOST_PORT=8000 src/api_service/scripts/docker-shell.sh
```

**å¼€å‘æ¨¡å¼ç‰¹ç‚¹ï¼š**
- ä»£ç ä¿®æ”¹åè‡ªåŠ¨é‡è½½
- æŒ‚è½½æœ¬åœ°ä»£ç åˆ°å®¹å™¨
- æ–¹ä¾¿è°ƒè¯•

#### æ–¹æ³•2ï¼šæœ¬åœ°è¿è¡Œï¼ˆä¸ä½¿ç”¨ Dockerï¼‰

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
cd AC215_AIMinO

# è®¾ç½® PYTHONPATH
export PYTHONPATH="${PWD}/src:${PWD}/aimino_frontend/src/aimino_frontend/aimino_core"

# è¿è¡Œåç«¯æœåŠ¡ï¼ˆæ”¯æŒçƒ­é‡è½½ï¼‰
src/api_service/scripts/run_api.sh
```

**æ³¨æ„ï¼š** æœ¬åœ°è¿è¡Œéœ€è¦å®‰è£…æ‰€æœ‰åç«¯ä¾èµ–ï¼Œå»ºè®®ä½¿ç”¨ Dockerã€‚

### 3.4 å¯åŠ¨å‰ç«¯ï¼ˆå¼€å‘æ¨¡å¼ï¼‰

ä¸æ–¹æ¡ˆAç›¸åŒï¼Œä½¿ç”¨ Napari èœå•æˆ–å‘½ä»¤è¡Œå¯åŠ¨ã€‚

---

## å››ã€æµ‹è¯•æ­¥éª¤

### 4.1 å®Œæ•´ç³»ç»Ÿæµ‹è¯•æµç¨‹

#### æ­¥éª¤1ï¼šéªŒè¯åç«¯è¿è¡Œ

```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://127.0.0.1:8000/api/v1/healthz

# åº”è¯¥è¿”å›ï¼š
# {"status":"ok","version":"0.1.0"}
```

#### æ­¥éª¤2ï¼šå¯åŠ¨ Napari å’Œæ’ä»¶

```bash
# å¯åŠ¨ Napari
napari

# åœ¨ Napari ä¸­æ‰“å¼€ AIMinO ChatBox
# Plugins â†’ AIMinO ChatBox â†’ Open ChatBox
```

#### æ­¥éª¤3ï¼šæµ‹è¯•åŸºæœ¬åŠŸèƒ½

åœ¨ ChatBox ä¸­å°è¯•ä»¥ä¸‹å‘½ä»¤ï¼š

1. **åˆ—å‡ºå›¾å±‚**
   ```
   show layers
   ```

2. **åˆ›å»ºæµ‹è¯•å›¾å±‚**
   ```
   add image layer
   ```

3. **æ§åˆ¶å›¾å±‚å¯è§æ€§**
   ```
   hide layer 0
   show layer 0
   ```

4. **ç›¸æœºæ§åˆ¶**
   ```
   center on 100,200
   zoom to 2.0
   ```

#### æ­¥éª¤4ï¼šæµ‹è¯•ç‰¹æ®Šåˆ†æåŠŸèƒ½

å¦‚æœå·²åŠ è½½å›¾åƒå’Œ h5ad æ–‡ä»¶ï¼Œå¯ä»¥æµ‹è¯•ï¼š

1. **åŠ è½½æ ‡è®°æ•°æ®**
   ```
   load marker data from /path/to/image.tif and /path/to/data.h5ad for SOX10_positive
   ```

2. **æ˜¾ç¤ºæ©ç **
   ```
   show SOX10_positive mask
   ```

3. **æ˜¾ç¤ºå¯†åº¦å›¾**
   ```
   show SOX10_positive density
   ```

4. **è®¡ç®—é‚»åŸŸåˆ†æ**
   ```
   compute tumor neighborhood for SOX10_positive with radius 50
   ```

### 4.2 API æµ‹è¯•

#### ä½¿ç”¨ curl æµ‹è¯•

```bash
# å¥åº·æ£€æŸ¥
curl http://127.0.0.1:8000/api/v1/healthz

# æµ‹è¯•å‘½ä»¤è§£æ
curl -X POST http://127.0.0.1:8000/api/v1/invoke \
  -H 'Content-Type: application/json' \
  -d '{
    "user_input": "show layers",
    "session_id": null
  }'
```

#### ä½¿ç”¨ Python æµ‹è¯•

```python
import requests

# æµ‹è¯•å¥åº·æ£€æŸ¥
response = requests.get("http://127.0.0.1:8000/api/v1/healthz")
print(response.json())

# æµ‹è¯•å‘½ä»¤è§£æ
response = requests.post(
    "http://127.0.0.1:8000/api/v1/invoke",
    json={"user_input": "show layers"}
)
print(response.json())
```

### 4.3 å‰ç«¯åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•æ’ä»¶æ³¨å†Œ

```bash
# æ£€æŸ¥æ’ä»¶æ˜¯å¦è¢« Napari è¯†åˆ«
napari --info | grep aimino

# æˆ–ä½¿ç”¨ npe2
npe2 list | grep aimino
```

#### æµ‹è¯•å‘½ä»¤è¡Œå·¥å…·

```bash
# æµ‹è¯•å‘½ä»¤è¡Œå…¥å£
aimino-napari --help

# æµ‹è¯• Python å¯¼å…¥
python -c "
from aimino_frontend.aimino_core import execute_command
from aimino_frontend.napari_app.client_agent import AgentClient
print('æ‰€æœ‰æ¨¡å—å¯¼å…¥æˆåŠŸï¼')
"
```

### 4.4 é›†æˆæµ‹è¯•

#### ç«¯åˆ°ç«¯æµ‹è¯•æµç¨‹

1. **å¯åŠ¨åç«¯**
   ```bash
   docker run --rm -p 8000:8000 --env-file .env aimino-api:dev
   ```

2. **å¯åŠ¨å‰ç«¯**
   ```bash
   napari
   # æ‰“å¼€ ChatBox
   ```

3. **å‘é€å‘½ä»¤**
   - åœ¨ ChatBox ä¸­è¾“å…¥ï¼š`show layers`
   - è§‚å¯Ÿåç«¯æ—¥å¿—è¾“å‡º
   - æ£€æŸ¥ Napari ä¸­çš„å“åº”

4. **éªŒè¯ç»“æœ**
   - å‘½ä»¤æ˜¯å¦æ­£ç¡®æ‰§è¡Œ
   - å›¾å±‚æ˜¯å¦æ­£ç¡®æ˜¾ç¤º/éšè—
   - é”™è¯¯ä¿¡æ¯æ˜¯å¦å‹å¥½

---

## äº”ã€å¸¸è§é—®é¢˜æ’æŸ¥

### 5.1 å‰ç«¯é—®é¢˜

#### é—®é¢˜1ï¼šæ’ä»¶åœ¨ Napari èœå•ä¸­ä¸æ˜¾ç¤º

**å¯èƒ½åŸå› ï¼š**
- æ’ä»¶æœªå®‰è£…åœ¨ Napari ä½¿ç”¨çš„ Python ç¯å¢ƒä¸­
- Napari ç¼“å­˜æœªæ›´æ–°

**è§£å†³æ–¹æ¡ˆï¼š**

```bash
# 1. ç¡®è®¤ Napari ä½¿ç”¨çš„ Python ç¯å¢ƒ
napari --info | grep "Python"

# 2. åœ¨è¯¥ç¯å¢ƒä¸­å®‰è£…æ’ä»¶
# å¦‚æœ Napari ä½¿ç”¨ conda ç¯å¢ƒ
conda activate <napari_env>
cd aimino_frontend
pip install -e .

# 3. æ¸…é™¤ Napari ç¼“å­˜
rm -rf ~/.napari/plugins

# 4. å®Œå…¨é‡å¯ Napari
# å…³é—­æ‰€æœ‰ Napari çª—å£ï¼Œç„¶åé‡æ–°å¯åŠ¨
```

#### é—®é¢˜2ï¼šæ— æ³•è¿æ¥åˆ°åç«¯

**é”™è¯¯ä¿¡æ¯ï¼š**
```
[agent error] HTTP invoke failed (check /healthz and server logs)
```

**è§£å†³æ–¹æ¡ˆï¼š**

```bash
# 1. æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ
curl http://127.0.0.1:8000/api/v1/healthz

# 2. æ£€æŸ¥ç¯å¢ƒå˜é‡
# ç¡®ä¿ .env æ–‡ä»¶ä¸­çš„ SERVER_URL æ­£ç¡®
# æˆ–è®¾ç½®ç¯å¢ƒå˜é‡
export SERVER_URL=http://127.0.0.1:8000

# 3. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
# ç¡®ä¿ç«¯å£ 8000 æœªè¢«é˜»æ­¢
```

#### é—®é¢˜3ï¼šä¾èµ–å®‰è£…å¤±è´¥

**é”™è¯¯ä¿¡æ¯ï¼š**
```
ERROR: Could not find a version that satisfies the requirement xxx
```

**è§£å†³æ–¹æ¡ˆï¼š**

```bash
# 1. æ›´æ–° pip
pip install --upgrade pip

# 2. æ£€æŸ¥ Python ç‰ˆæœ¬
python --version  # éœ€è¦ >= 3.10

# 3. ä½¿ç”¨ conda å®‰è£…æŸäº›ä¾èµ–ï¼ˆå¦‚æœ pip å¤±è´¥ï¼‰
conda install -c conda-forge <package_name>
```

### 5.2 åç«¯é—®é¢˜

#### é—®é¢˜1ï¼šDocker æ„å»ºå¤±è´¥

**å¯èƒ½åŸå› ï¼š**
- Docker æœªè¿è¡Œ
- ç½‘ç»œé—®é¢˜
- Dockerfile é”™è¯¯

**è§£å†³æ–¹æ¡ˆï¼š**

```bash
# 1. æ£€æŸ¥ Docker æ˜¯å¦è¿è¡Œ
docker ps

# 2. æ£€æŸ¥ Docker ç‰ˆæœ¬
docker --version

# 3. æ¸…ç† Docker ç¼“å­˜åé‡è¯•
docker system prune -a

# 4. æŸ¥çœ‹è¯¦ç»†æ„å»ºæ—¥å¿—
DOCKER_BUILDKIT=1 docker build --progress=plain -t aimino-api:dev -f src/api_service/Dockerfile .
```

#### é—®é¢˜2ï¼šåç«¯å¯åŠ¨å¤±è´¥

**é”™è¯¯ä¿¡æ¯ï¼š**
```
ERROR: uvicorn not found
```

**è§£å†³æ–¹æ¡ˆï¼š**

```bash
# 1. æ£€æŸ¥ Docker é•œåƒæ˜¯å¦æ„å»ºæˆåŠŸ
docker images | grep aimino-api

# 2. æ£€æŸ¥ .env æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la .env

# 3. æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs <container_id>
```

#### é—®é¢˜3ï¼šAPI è¿”å›é”™è¯¯

**é”™è¯¯ä¿¡æ¯ï¼š**
```
500 Internal Server Error
```

**è§£å†³æ–¹æ¡ˆï¼š**

```bash
# 1. æ£€æŸ¥åç«¯æ—¥å¿—
# å¦‚æœä½¿ç”¨ Docker
docker logs <container_id>

# 2. æ£€æŸ¥ç¯å¢ƒå˜é‡
# ç¡®ä¿ GOOGLE_API_KEY æˆ– GEMINI_API_KEY å·²è®¾ç½®

# 3. æµ‹è¯•å¥åº·æ£€æŸ¥ç«¯ç‚¹
curl http://127.0.0.1:8000/api/v1/healthz
```

#### é—®é¢˜4ï¼šåç«¯å¯åŠ¨æ—¶å‡ºç°æ¨¡å—ç¼ºå¤±è­¦å‘Š

**è­¦å‘Šä¿¡æ¯ï¼š**
```
WARNING: Failed to import handler module .special_analysis.mask_handler: No module named 'tifffile'
WARNING: Failed to import handler module .special_analysis.density_handler: No module named 'anndata'
WARNING: Failed to import handler module .special_analysis.mask_handler: fontconfig not found
```

**åŸå› ï¼š** åç«¯ Docker é•œåƒç¼ºå°‘ç‰¹æ®Šåˆ†æåŠŸèƒ½æ‰€éœ€çš„ä¾èµ–ï¼ˆPython åŒ…å’Œç³»ç»ŸåŒ…ï¼‰ã€‚

**è§£å†³æ–¹æ¡ˆï¼š**

```bash
# 1. ç¡®è®¤ src/api_service/pyproject.toml åŒ…å«ä»¥ä¸‹ Python ä¾èµ–ï¼š
#    - anndata
#    - tifffile
#    - scipy
#    - scikit-image
#    - numpy
#    - napari

# 2. ç¡®è®¤ src/api_service/Dockerfile åŒ…å«ä»¥ä¸‹ç³»ç»ŸåŒ…ï¼š
#    - fontconfig
#    - libfontconfig1
#    - libgl1-mesa-glx
#    - libglib2.0-0

# 3. æ›´æ–°ä¾èµ–é”æ–‡ä»¶ï¼ˆå¦‚æœä½¿ç”¨ uvï¼‰
cd src/api_service
uv lock

# 4. é‡æ–°æ„å»º Docker é•œåƒ
cd ../..
DOCKER_BUILDKIT=1 docker build -t aimino-api:dev -f src/api_service/Dockerfile .

# 5. é‡æ–°å¯åŠ¨å®¹å™¨
docker run --rm -p 8000:8000 --env-file .env aimino-api:dev
```

**æ³¨æ„ï¼š** 
- è¿™äº›è­¦å‘Šä¸ä¼šå½±å“åç«¯çš„åŸºæœ¬åŠŸèƒ½ï¼Œä½†ç‰¹æ®Šåˆ†æåŠŸèƒ½ï¼ˆå¦‚åŠ è½½æ ‡è®°æ•°æ®ã€è®¡ç®—å¯†åº¦å›¾ç­‰ï¼‰å°†ä¸å¯ç”¨
- `fontconfig` æ˜¯ç³»ç»Ÿçº§ä¾èµ–ï¼Œéœ€è¦åœ¨ Dockerfile ä¸­å®‰è£…ï¼Œä¸èƒ½é€šè¿‡ pip å®‰è£…
- é‡æ–°æ„å»ºé•œåƒåï¼Œè¿™äº›è­¦å‘Šåº”è¯¥æ¶ˆå¤±

### 5.3 ç¯å¢ƒé—®é¢˜

#### é—®é¢˜1ï¼šPython ç‰ˆæœ¬ä¸åŒ¹é…

**è§£å†³æ–¹æ¡ˆï¼š**

```bash
# æ£€æŸ¥ Python ç‰ˆæœ¬
python --version

# å¦‚æœç‰ˆæœ¬ < 3.10ï¼Œéœ€è¦å‡çº§æˆ–ä½¿ç”¨ conda
conda create -n aimino python=3.10
conda activate aimino
```

#### é—®é¢˜2ï¼šç«¯å£è¢«å ç”¨

**é”™è¯¯ä¿¡æ¯ï¼š**
```
Address already in use
```

**è§£å†³æ–¹æ¡ˆï¼š**

```bash
# 1. æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
# macOS/Linux:
lsof -i :8000

# 2. æ€æ­»è¿›ç¨‹
kill -9 <PID>

# æˆ–ä½¿ç”¨å…¶ä»–ç«¯å£
export AIMINO_SERVER_PORT=8001
```

---

## å…­ã€æµ‹è¯•æ£€æŸ¥æ¸…å•

åœ¨å¼€å§‹æµ‹è¯•å‰ï¼Œç¡®è®¤ä»¥ä¸‹é¡¹ç›®ï¼š

### ç¯å¢ƒå‡†å¤‡
- [ ] Python >= 3.10 å·²å®‰è£…
- [ ] Docker å·²å®‰è£…å¹¶è¿è¡Œ
- [ ] Napari >= 0.4.0 å·²å®‰è£…
- [ ] ç½‘ç»œè¿æ¥æ­£å¸¸ï¼ˆç”¨äºä¸‹è½½ä¾èµ–å’Œ API è°ƒç”¨ï¼‰
- [ ] ä¸´æ—¶æµ‹è¯•ç¯å¢ƒå·²åˆ›å»ºå¹¶æ¿€æ´»ï¼ˆæ¨èï¼‰

### å‰ç«¯å®‰è£…
- [ ] ä¸´æ—¶è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»ï¼ˆå‘½ä»¤æç¤ºç¬¦æ˜¾ç¤ºç¯å¢ƒåï¼‰
- [ ] `aimino` åŒ…å·²å®‰è£…ï¼ˆ`pip show aimino`ï¼‰
- [ ] å‘½ä»¤è¡Œå·¥å…·å¯ç”¨ï¼ˆ`aimino-napari --help`ï¼‰
- [ ] Python æ¨¡å—å¯å¯¼å…¥ï¼ˆ`python -c "import aimino_frontend"`ï¼‰
- [ ] æ’ä»¶åœ¨ Napari ä¸­å¯è§

### åç«¯é…ç½®
- [ ] `.env` æ–‡ä»¶å·²åˆ›å»ºå¹¶é…ç½®
- [ ] `GOOGLE_API_KEY` æˆ– `GEMINI_API_KEY` å·²è®¾ç½®
- [ ] Docker é•œåƒå·²æ„å»ºï¼ˆ`docker images | grep aimino-api`ï¼‰
- [ ] åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œï¼ˆ`curl http://127.0.0.1:8000/api/v1/healthz`ï¼‰

### åŠŸèƒ½æµ‹è¯•
- [ ] åç«¯å¥åº·æ£€æŸ¥é€šè¿‡
- [ ] å‰ç«¯å¯ä»¥è¿æ¥åˆ°åç«¯
- [ ] åŸºæœ¬å‘½ä»¤å¯ä»¥æ‰§è¡Œï¼ˆå¦‚ "show layers"ï¼‰
- [ ] é”™è¯¯å¤„ç†æ­£å¸¸å·¥ä½œ
- [ ] ç‰¹æ®Šåˆ†æåŠŸèƒ½å¯ç”¨ï¼ˆå¦‚æœå·²åŠ è½½æ•°æ®ï¼‰

---

## ä¸ƒã€å¿«é€Ÿæµ‹è¯•è„šæœ¬

### 7.1 åç«¯å¥åº·æ£€æŸ¥è„šæœ¬

åˆ›å»º `test_backend.sh`ï¼š

```bash
#!/bin/bash
echo "æµ‹è¯•åç«¯æœåŠ¡..."

# å¥åº·æ£€æŸ¥
echo "1. å¥åº·æ£€æŸ¥..."
response=$(curl -s http://127.0.0.1:8000/api/v1/healthz)
if [[ $response == *"ok"* ]]; then
    echo "âœ“ åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ"
else
    echo "âœ— åç«¯æœåŠ¡å¼‚å¸¸: $response"
    exit 1
fi

# API æµ‹è¯•
echo "2. API è°ƒç”¨æµ‹è¯•..."
response=$(curl -s -X POST http://127.0.0.1:8000/api/v1/invoke \
  -H 'Content-Type: application/json' \
  -d '{"user_input":"show layers"}')
if [[ $response == *"final_commands"* ]]; then
    echo "âœ“ API è°ƒç”¨æˆåŠŸ"
else
    echo "âœ— API è°ƒç”¨å¤±è´¥: $response"
    exit 1
fi

echo "æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼"
```

ä½¿ç”¨ï¼š
```bash
chmod +x test_backend.sh
./test_backend.sh
```

### 7.2 å‰ç«¯æµ‹è¯•è„šæœ¬

åˆ›å»º `test_frontend.sh`ï¼š

```bash
#!/bin/bash
echo "æµ‹è¯•å‰ç«¯å®‰è£…..."

# æ£€æŸ¥æ˜¯å¦åœ¨è™šæ‹Ÿç¯å¢ƒä¸­
if [[ -z "${VIRTUAL_ENV:-}" ]] && [[ -z "${CONDA_DEFAULT_ENV:-}" ]]; then
    echo "âš  è­¦å‘Š: æœªæ£€æµ‹åˆ°è™šæ‹Ÿç¯å¢ƒï¼Œå»ºè®®åœ¨è™šæ‹Ÿç¯å¢ƒä¸­æµ‹è¯•"
    read -p "æ˜¯å¦ç»§ç»­ï¼Ÿ(y/n) " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        exit 1
    fi
else
    echo "âœ“ æ£€æµ‹åˆ°è™šæ‹Ÿç¯å¢ƒ"
    if [[ -n "${VIRTUAL_ENV:-}" ]]; then
        echo "  è™šæ‹Ÿç¯å¢ƒ: $VIRTUAL_ENV"
    elif [[ -n "${CONDA_DEFAULT_ENV:-}" ]]; then
        echo "  Conda ç¯å¢ƒ: $CONDA_DEFAULT_ENV"
    fi
fi

# æ£€æŸ¥åŒ…å®‰è£…
if pip show aimino > /dev/null 2>&1; then
    echo "âœ“ aimino åŒ…å·²å®‰è£…"
    pip show aimino | grep Version
else
    echo "âœ— aimino åŒ…æœªå®‰è£…"
    exit 1
fi

# æ£€æŸ¥å‘½ä»¤è¡Œå·¥å…·
if command -v aimino-napari &> /dev/null; then
    echo "âœ“ å‘½ä»¤è¡Œå·¥å…·å¯ç”¨"
else
    echo "âœ— å‘½ä»¤è¡Œå·¥å…·ä¸å¯ç”¨"
    exit 1
fi

# æ£€æŸ¥ Python å¯¼å…¥
if python -c "import aimino_frontend" 2>/dev/null; then
    echo "âœ“ Python æ¨¡å—å¯å¯¼å…¥"
else
    echo "âœ— Python æ¨¡å—å¯¼å…¥å¤±è´¥"
    exit 1
fi

echo "å‰ç«¯æµ‹è¯•é€šè¿‡ï¼"
```

ä½¿ç”¨ï¼š
```bash
chmod +x test_frontend.sh
./test_frontend.sh
```

---

## å…«ã€æŒç»­æµ‹è¯•å»ºè®®

### 8.1 å¼€å‘æ—¶æµ‹è¯•

- æ¯æ¬¡ä¿®æ”¹ä»£ç åï¼Œé‡æ–°æµ‹è¯•ç›¸å…³åŠŸèƒ½
- ä½¿ç”¨ Docker çš„çƒ­é‡è½½åŠŸèƒ½ï¼Œå¿«é€ŸéªŒè¯æ›´æ”¹
- ä¿æŒåç«¯å’Œå‰ç«¯åŒæ—¶è¿è¡Œï¼Œæµ‹è¯•ç«¯åˆ°ç«¯æµç¨‹

### 8.2 å‘å¸ƒå‰æµ‹è¯•

- åœ¨å¹²å‡€çš„è™šæ‹Ÿç¯å¢ƒä¸­æµ‹è¯•å®‰è£…
- æµ‹è¯•ä» PyPI å®‰è£…ï¼ˆå¦‚æœå·²å‘å¸ƒï¼‰
- éªŒè¯æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- æ£€æŸ¥é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæƒ…å†µ

---

## ğŸ“š å‚è€ƒèµ„æº

- [é¡¹ç›® README](../README.md)
- [PyPI å‘å¸ƒæŒ‡å—](./aimino_frontend/PyPIå‘å¸ƒæŒ‡å—.md)
- [åç«¯ API æ–‡æ¡£](./src/api_service/README.md)
- [Napari æ’ä»¶å¼€å‘æ–‡æ¡£](https://napari.org/stable/plugins/index.html)

---

**ç¥æµ‹è¯•é¡ºåˆ©ï¼** ğŸš€

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹é¡¹ç›® Issues æˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚

